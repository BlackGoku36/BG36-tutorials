<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Resources - BG-36's Tutorials | Armory</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="The example book covers examples.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../a.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../GettingStarted/Introduction.html"><strong aria-hidden="true">1.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../GettingStarted/Setup.html"><strong aria-hidden="true">1.2.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../../GettingStarted/PitAndMis.html"><strong aria-hidden="true">1.3.</strong> Pitfall and Misconception</a></li></ol></li><li class="chapter-item expanded "><a href="../../a.html"><strong aria-hidden="true">2.</strong> Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Basics/Canvas.html"><strong aria-hidden="true">2.1.</strong> Canvas</a></li><li class="chapter-item expanded "><a href="../../Basics/Navmesh.html"><strong aria-hidden="true">2.2.</strong> Navmesh</a></li><li class="chapter-item expanded "><a href="../../Basics/Tilesheet.html"><strong aria-hidden="true">2.3.</strong> Tilesheet</a></li><li class="chapter-item expanded "><a href="../../Basics/Trait.html"><strong aria-hidden="true">2.4.</strong> Trait</a></li></ol></li><li class="chapter-item expanded "><a href="../../a.html"><strong aria-hidden="true">3.</strong> Mechanism</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Mechanism/SaveLoad/Introduction.html"><strong aria-hidden="true">3.1.</strong> Save and Load Mechanism</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Mechanism/SaveLoad/SL-1.html"><strong aria-hidden="true">3.1.1.</strong> Read/Write file</a></li><li class="chapter-item expanded "><a href="../../Mechanism/SaveLoad/SL-2.html"><strong aria-hidden="true">3.1.2.</strong> Save/Load game file</a></li><li class="chapter-item expanded "><a href="../../Mechanism/SaveLoad/SL-3.html"><strong aria-hidden="true">3.1.3.</strong> UI</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../a.html"><strong aria-hidden="true">4.</strong> Game Demo</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../GameDemo/CitySim/Introduction.html"><strong aria-hidden="true">4.1.</strong> City Sim</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../GameDemo/CitySim/Basics.html"><strong aria-hidden="true">4.1.1.</strong> Basics</a></li><li class="chapter-item expanded "><a href="../../GameDemo/CitySim/Resources.html" class="active"><strong aria-hidden="true">4.1.2.</strong> Resources</a></li><li class="chapter-item expanded "><a href="../../GameDemo/CitySim/UI.html"><strong aria-hidden="true">4.1.3.</strong> UI</a></li><li class="chapter-item expanded "><a href="../../GameDemo/CitySim/FAQ.html"><strong aria-hidden="true">4.1.4.</strong> FAQ</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../HowToRead.html">How-to read</a></li><li class="chapter-item expanded affix "><a href="../../FAQ.html">FAQ</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="dark">Dark (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">BG-36's Tutorials | Armory</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/BlackGoku36/BG36-tutorials/tree/master" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2><a class="header" href="#resources" id="resources">Resources</a></h2>
<hr />
<p>In <code>Resources</code>, we will involve resource producing and collecting from buildings.</p>
<p>Rechecking our concept, when we place buildings, we want it to produce some resources at cost of some other resources, here the small table from the concept:</p>
<table><thead><tr><th>Buildings</th><th>Costs</th><th>Produce</th></tr></thead><tbody>
<tr><td>House</td><td>Woods, Stones, Electricity</td><td>Money, Happiness</td></tr>
<tr><td>Parks</td><td>Woods, Stones, Electricity</td><td>Money, Happiness</td></tr>
<tr><td>Sawmills</td><td>Money, Electricity</td><td>Woods, Pollution</td></tr>
<tr><td>Quarry</td><td>Money, Electricity</td><td>Stones, Pollution</td></tr>
<tr><td>Powerplants</td><td>Money</td><td>Electricity, Pollution</td></tr>
</tbody></table>
<hr />
<p>Table of contents:</p>
<ul>
<li>
<p><strong>RESOURCES</strong></p>
<ul>
<li><a href="docs/Game_Demo/City_Sim/Resources#building-properties-structure">Building properties structure</a></li>
<li><a href="docs/Game_Demo/City_Sim/Resources#recalculate-buildings">Recalculate buildings</a></li>
<li><a href="docs/Game_Demo/City_Sim/Resources#recalculate-resources">Recalculate resources</a></li>
<li><a href="docs/Game_Demo/City_Sim/Resources#producing-resources">Producing resources</a></li>
</ul>
</li>
<li>
<p><a href="docs/Game_Demo/City_Sim/Resources#canvas">Canvas</a></p>
</li>
</ul>
<hr />
<h2><a class="header" href="#resources-1" id="resources-1">RESOURCES</a></h2>
<p>Buildings will produce given amount of resources in given interval of time. We want to make:</p>
<ul>
<li>House produce 5 money every 5 sec at cost of 10 woods and 10 stones.</li>
<li>Sawmill produce 5 woods every 5 sec at cost of 10 money.</li>
<li>Quarry produce 5 stones every 5 sec at cost of 10 money.</li>
<li>Powerplant produce 10 electricity every 5 sec at cost of 20 money.</li>
<li>Electricity to be used by house, sawmill, quarry to produce their resources, if they don't get enough electricity, they stop production.</li>
</ul>
<p><em>(values are not absolute, it needed to be tweak for final game)</em></p>
<h3><a class="header" href="#building-properties-structure" id="building-properties-structure">BUILDING PROPERTIES STRUCTURE</a></h3>
<p>Let create proper structure of our building property, where we will store buildings properties such as maximum buildings allowed, cost, production, etc.</p>
<ol>
<li>Create new scene Haxe trait <code>WorldController</code>, this will act as our main world controller.</li>
</ol>
<!-- tabs:start -->
<h4><a class="header" href="#worldcontrollerhx" id="worldcontrollerhx"><strong>WorldController.hx</strong></a></h4>
<pre><code class="language-haxe">package arm;
//Building properties structure
typedef BuildingProp = {
    //at: how many building are there currently?, max: how many maximum buildings can be spawned?
    at:Int, max:Int,
    //Cost amount of money, wood, stones, electricity
    costM:Int, costW:Int, costS:Int, costE:Int,
    //Produce amount of money, woods, stones, electricity
    prodM: Int, prodW:Int, prodS:Int, prodE:Int,
    //Produce amount of happiness, pollution
    prodH:Int, prodP:Int,
    //Timetask id
    tt: Int
}

class WorldController extends iron.Trait {
    //Set houses prop
    public static var houseProp: BuildingProp = {
        at:0, max:2, costM: 0,costW:10, costS:10, costE:5, prodM: 5, prodW:0, prodS:0, prodE: 0, prodH:3, prodP:0, tt: 0
    };
    //Set parks prop
    public static var parkProp: BuildingProp = {
        at:0, max:2, costM: 0,costW:10, costS:10, costE:5, prodM: 5, prodW:0, prodS:0, prodE: 0, prodH:5, prodP:0, tt: 0
    };
    //Set sawmills prop
    public static var sawmillProp: BuildingProp = {
        at:0, max:2, costM: 10,costW:0, costS:0, costE:5, prodM: 0, prodW:5, prodS:0, prodE: 0, prodH:0, prodP:3, tt: 0
    };
    //Set quarrys prop
    public static var quarryProp: BuildingProp = {
        at:0, max:2, costM: 10, costW:0, costS:0, costE:5, prodM: 0, prodW:0, prodS:5, prodE: 0, prodH:0, prodP:3, tt: 0
    };
    //Set powerplants prop
    public static var powerplantProp: BuildingProp = {
        at:0, max:2, costM: 20, costW:0, costS:0, costE:0, prodM: 0, prodW:0, prodS:0, prodE: 10, prodH:0, prodP:5, tt: 0
    };

    public function new() {
        super();
    }
}

</code></pre>
<hr />
<details>
    <summary>Code Explanation</summary>
<ol>
<li>
<p>We create buildings properties structure to store information and fields which are not needed are set to '0' as we don't want to create structure for each building.</p>
</li>
<li>
<p>We set properties of buildings <code>houseProp</code>, <code>parkProp</code>, etc.</p>
</li>
</ol>
</details>
<hr />
<!-- tabs:end -->
<h3><a class="header" href="#recalculate-buildings" id="recalculate-buildings">RECALCULATE BUILDINGS</a></h3>
<p>We will recalculate buildings from buildings structure and set building properties structure and limit amount of particular buildings that can be spawned.</p>
<!-- tabs:start -->
<h4><a class="header" href="#buildingcontrollerhx" id="buildingcontrollerhx"><strong>BuildingController.hx</strong></a></h4>
<pre><code class="language-haxe">~
import arm.WorldController;

typedef Building = {~}
class BuildingController extends iron.Trait{
    ~
    public static var enoughBuildings = true;
    public function new(){~}
    ~
    public static function spawnBuilding(type: Int){
        var world = WorldController;
        //Check if this type of buildings reached max amount
        checkMaxBuilding(type);
        //If there is not enough building
        if(!enoughBuildings){
            Scene.active.spawnObject(&quot;bld_&quot;+type, null, function(bld: Object){
                ~
                buildings.push({~});
                //Recalculate amount of buildings
                recalculateBuildings();
                unselectBuilding();
                selectBuilding(bld.name);
            });
        }

    }
    public static function removeBuilding(){
        Scene.active.getChild(selectedBuilding).remove();
        removefromArray(selectedBuilding, buildings);
        //Recalculate amount of buildings
        recalculateBuildings();
        unselectBuilding();
    }
    ~
    static function recalculateBuildings(){
        var world = WorldController;
        //Create buildings type list
        //[House, parks,......, powerplant]
        var buildingList = [0, 0, 0, 0, 0, 0, 0, 0];
        for(building in buildings){
            switch (building.type){
                //Set increase building list by one of certain type
                case 1: buildingList[0] += 1;//House
                case 2: buildingList[1] += 1;//Park
                case 5: buildingList[4] += 1;//Sawmill
                case 6: buildingList[5] += 1;//Quarry
                case 8: buildingList[7] += 1;//Powerplant
            }
        }
        //Set 'at' of building property
        world.houseProp.at = buildingList[0];
        world.parkProp.at = buildingList[1];
        world.sawmillProp.at = buildingList[4];
        world.quarryProp.at = buildingList[5];
        world.powerplantProp.at = buildingList[7];
    }
    static function checkMaxBuilding(type:Int){
        var world = WorldController;
        switch(type){
            //Check if building of type reached max amount, then set enough buildings to true else false
            case 1: world.houseProp.at == world.houseProp.max ? enoughBuildings = true : enoughBuildings = false;
            case 2: world.parkProp.at == world.parkProp.max ? enoughBuildings = true : enoughBuildings = false;
            case 5: world.sawmillProp.at == world.sawmillProp.max ? enoughBuildings = true : enoughBuildings = false;
            case 6: world.quarryProp.at == world.quarryProp.max ? enoughBuildings = true : enoughBuildings = false;
            case 8: world.powerplantProp.at == world.powerplantProp.max ? enoughBuildings = true : enoughBuildings = false;
        }
    }
}
</code></pre>
<hr />
<details>
    <summary>Code Explanation</summary>
<ol>
<li>
<p>In <code>recalculateBuildings()</code>, we create array of building list, each index represent building type. Then we loop through our array of buildings and switch through building types and increase the building list by one if type matches. And finally set 'at' of our buildings property from building list.</p>
</li>
<li>
<p>In <code>checkMaxBuilding(*type*)</code>, we switch through types, if type match we check building of type's property and check if no. of buildings is same as maximum limit, if true than set enoughBuildings to true, else false.</p>
</li>
<li>
<p>In <code>spawnBuilding(*type*)</code>, check if maximum amount of buildings of particular type reached, if not true than allow to spawn, and then on spawning recalculate buildings again.</p>
</li>
<li>
<p>In <code>removeBuilding()</code>, recalculate buildings again after selected building is removed.</p>
</li>
</ol>
</details>
<hr />
<!-- tabs:end -->
<h3><a class="header" href="#recalculate-resources" id="recalculate-resources">RECALCULATE RESOURCES</a></h3>
<p>We will recalculate resources after we spawn the building, i.e., after spawning we subtract the building's resource cost from total resources. And we will also limit buildings from being spawned if total resource is less than building's resource cost.</p>
<!-- tabs:start -->
<h4><a class="header" href="#worldcontrollerhx-1" id="worldcontrollerhx-1"><strong>WorldController.hx</strong></a></h4>
<pre><code class="language-haxe">~
typedef BuildingProp = {~}

class WorldController extends iron.Trait {
    //Set resources with array -&gt; [at, max]
    public static var happiness:Array&lt;Int&gt; = [50, 100];
    public static var money:Array&lt;Int&gt; = [50, 100];
    public static var woods:Array&lt;Int&gt; = [50, 100];
    public static var stones:Array&lt;Int&gt; = [50, 100];
    public static var electricity:Array&lt;Int&gt; = [0, 100];

    public static var houseProp: BuildingProp = {~};
    public static var parkProp: BuildingProp = {~};
    public static var sawmillProp: BuildingProp = {~};
    public static var quarryProp: BuildingProp = {~};
    public static var powerplantProp: BuildingProp = {~};

    public function new(){~}

}
</code></pre>
<hr />
<details>
    <summary>Code Explanation</summary>
<ol>
<li>We set resources with array as [amount of this resource, maximum resource storeable].</li>
</ol>
</details>
<hr />
<h4><a class="header" href="#buildingcontrollerhx-1" id="buildingcontrollerhx-1"><strong>BuildingController.hx</strong></a></h4>
<pre><code class="language-haxe">~
typedef Building = {~}
class BuildingController extends iron.Trait{
    ~
    public static var enoughBuildings = true;
    public static var enoughResources = true;
    public function new(){~}
    ~
    public static function spawnBuilding(type: Int){
        var world = WorldController;
        checkMaxBuilding(type);
        //Check if resources reached max amount
        checkResources(type);
        //If there is not enough building and there is enough resource
        if(!enoughBuildings &amp;&amp; enoughResources){
            Scene.active.spawnObject(&quot;bld_&quot;+type, null, function(bld: Object){
                ~
                buildings.push({~});
                recalculateBuildings();
                //Recalculate amount of resources of this type
                recalculateResources(type);
                unselectBuilding();
                selectBuilding(bld.name);
            });
        }
    }
    public static function removeBuilding(){~}
    ~
    static function recalculateBuildings(){~}
    static function checkResources(type:Int){
        var world = WorldController;
        switch(type){
            case 1: (world.woods[0] &lt; world.houseProp.costW &amp;&amp; world.stones[0] &lt; world.houseProp.costS) ? enoughResources = false : enoughResources = true;
            case 5: (world.money[0] &lt; world.sawmillProp.costM) ? enoughResources = false : enoughResources = true;
            case 6: (world.money[0] &lt; world.quarryProp.costM) ? enoughResources = false : enoughResources = true;
            case 8: (world.money[0] &lt; world.powerplantProp.costM) ? enoughResources = false : enoughResources = true;
        }
    }
    static function recalculateResources(type:Int) {
        var world = WorldController;
        switch(type){
            case 1:
                world.woods[0] -= world.houseProp.costW;
                world.stones[0] -= world.houseProp.costS;
            case 5:
                world.money[0] -= world.sawmillProp.costM;
            case 6:
                world.money[0] -= world.quarryProp.costM;
            case 8:
                world.money[0] -= world.powerplantProp.costM;
        }
    }
    static function checkMaxBuilding(type:Int){~}
}
</code></pre>
<hr />
<details>
    <summary>Code Explanation</summary>
<ol>
<li>In <code>recalculateResources(*type*)</code>, We recalculate resources by subtracting cost from resources amount with given type.</li>
<li>In <code>checkResources(*type*)</code>, we check if resources available is less than the cost, if so, then we set enoughResources to true else false.</li>
<li>We check resources before spawning, if there is enough resources and not enough building then we spawn the building, when spawned we recalculate the resources.</li>
</ol>
</details>
<hr />
<!-- tabs:end -->
<h3><a class="header" href="#producing-resources" id="producing-resources">PRODUCING RESOURCES</a></h3>
<p>Now, we want buildings to produce resources at given interval. This can be simply done by using kha's Scheduler timetask.</p>
<!-- tabs:start -->
<h4><a class="header" href="#worldcontrollerhx-2" id="worldcontrollerhx-2"><strong>WorldController.hx</strong></a></h4>
<pre><code class="language-haxe">package arm;

import kha.Scheduler;

import arm.BuildingController;
import arm.MainCanvasController;

typedef BuildingProp = {~}

class WorldController extends iron.Trait {

    public static var money:Array&lt;Int&gt; = [50, 100];
    ~
    public static var electricity:Array&lt;Int&gt; = [0, 100];

    public static var houseProp: BuildingProp = {~};
    ~
    public static var powerplantProp: BuildingProp = {~};

    public function new() {
        super();
        notifyOnInit(init);
    }

    function init() {
        var world = WorldController;
        //Add timetask with interval of 5sec and assign timetask id to housett.
        houseProp.tt = Scheduler.addTimeTask(function(){
            //check electricity, if electricity is greater than cost and money amount is less than max money
            if (electricity[0] &gt;= world.houseProp.costE &amp;&amp; money[0] &lt; money[1]){
                // increase by (no.of houses x house money production.)
                money[0] += houseProp.at * houseProp.prodM;
                //Do clamping and handle overflowing
                if (money[0] &gt; money[1]) money[0] = money[1];
                //Multiply no. of houses * houses cost and subtract the product from electricity amount
                electricity[0] -= houseProp.at * houseProp.costE;
            }
        }, 5, 5);
        parkProp.tt = Scheduler.addTimeTask(function(){
            if (electricity[0] &gt;= world.parkProp.costE &amp;&amp; money[0] &lt; money[1]){
                money[0] += parkProp.at * parkProp.prodM;
                if (money[0] &gt; money[1]) money[0] = money[1];
                electricity[0] -= parkProp.at * parkProp.costE;
            }
        }, 5, 5);
        sawmillProp.tt = Scheduler.addTimeTask(function(){
            if (electricity[0] &gt;= world.sawmillProp.costE &amp;&amp; woods[0] &lt; woods[1]){
                woods[0] += sawmillProp.at * sawmillProp.prodW;
                if (woods[0] &gt; woods[1]) woods[0] = woods[1];
                electricity[0] -= sawmillProp.at * sawmillProp.costE;
            }
        }, 5, 5);
        quarryProp.tt = Scheduler.addTimeTask(function(){
            if (electricity[0] &gt;= world.quarryProp.costE &amp;&amp; stones[0] &lt; stones[1]){
                stones[0] += quarryProp.at * quarryProp.prodS;
                if (stones[0] &gt; stones[1]) stones[0] = stones[1];
                electricity[0] -= quarryProp.at * quarryProp.costE;
            }
        }, 5, 5);
        powerplantProp.tt = Scheduler.addTimeTask(function(){
            if(electricity[0] &lt;= electricity[1]) electricity[0] += powerplantProp.at * powerplantProp.prodE;
        }, 5, 5);
    }
}
</code></pre>
<hr />
<details>
    <summary>Code Explanation</summary>
<ol>
<li>We create timetask for each building type, this is done by <code>kha.Scheduler.addTimeTask(*func*, *start*, *period*, *duration*)</code>, where <code>func</code> is function done in this time task, <code>start</code> is time to wait for first <code>func</code> execution, <code>period</code> is time interval between <code>func</code> execution, <code>duration</code>, is total amount of time this time task exist for, '0' means infinite amount of time and is set defaultly.</li>
<li>We than check if there is sufficient electricity, than check if the resource is less than max, if so than let it produce the resource. Then we will check if resource is more than max resource if so, than set resource as max resources(This works as clamping and to prevent money overflowing).Then multiply no. of building by building's electricity cost and subtract the product from electricity amount.</li>
</ol>
</details>
<hr />
<!-- tabs:end -->
<hr />
<h2><a class="header" href="#canvas" id="canvas">CANVAS</a></h2>
<p>We will use <code>Canvas</code> to display our resources with progress bars.</p>
<ol>
<li>Create new canvas <code>MainCanvas</code> and uncheck it, we will use this as our main canvas, we will have other UI such as menus in here.</li>
</ol>
<p>In <code>MainCanvas</code>, create:</p>
<ol>
<li>
<p><code>Text</code> element:</p>
<ol>
<li><code>Name</code>: money. <code>Text</code>: Money</li>
<li><code>Name</code>: wood. <code>Text</code>: Wood</li>
<li><code>Name</code>: stone. <code>Text</code>: Stone</li>
<li><code>Name</code>: electricity. <code>Text</code>: Electricity</li>
<li><code>Name</code>: money-amt, wood-amt, stone-amt, electricity-amt. <code>Text</code>: 0/100</li>
</ol>
</li>
<li>
<p><code>RectPB</code> element:</p>
<ol>
<li><code>Name</code>: moneypb, woodpb, stonepb, electricitypb. <code>Progress</code>: 0. <code>Total progress</code>: 100</li>
</ol>
</li>
</ol>
<p><img src="../../CBS_2_1.png" alt="Some Image" /></p>
<hr />
<p>On to the script, to control the amount and progress bars.</p>
<ol>
<li>Create new Haxe trait <code>MainCanvasController</code></li>
</ol>
<!-- tabs:start -->
<h4><a class="header" href="#maincanvascontrollerhx" id="maincanvascontrollerhx"><strong>MainCanvasController.hx</strong></a></h4>
<pre><code class="language-haxe">package arm;

import armory.trait.internal.CanvasScript;
import iron.Scene;
import arm.WorldController;

class MainCanvasController extends iron.Trait {

    static var maincanvas:CanvasScript;
    var world = WorldController;

    public function new() {
        super();
        notifyOnInit(function() {
            //Set canvas on init
            maincanvas = new CanvasScript(&quot;MainCanvas&quot;, &quot;Big_shoulders_text.ttf&quot;);
            maincanvas.setCanvasVisibility(true);
        });
        notifyOnUpdate(updateCanvas);
    }

    function updateCanvas() {
        //Update PB and Amount
        updatePB();
        updateAmount();
    }
    function updatePB() {
        //Set progress bar elements's 'at' and 'total'
        maincanvas.getElement(&quot;moneypb&quot;).progress_total = world.money[1];
        maincanvas.getElement(&quot;moneypb&quot;).progress_at = world.money[0];
        maincanvas.getElement(&quot;woodpb&quot;).progress_total = world.woods[1];
        maincanvas.getElement(&quot;woodpb&quot;).progress_at = world.woods[0];
        maincanvas.getElement(&quot;stonepb&quot;).progress_total = world.stones[1];
        maincanvas.getElement(&quot;stonepb&quot;).progress_at = world.stones[0];
        maincanvas.getElement(&quot;electricitypb&quot;).progress_total = world.electricity[1];
        maincanvas.getElement(&quot;electricitypb&quot;).progress_at = world.electricity[0];
    }
    function updateAmount() {
        //Set amount text element's text to 'resource/totalresource'
        maincanvas.getElement(&quot;money-amt&quot;).text = world.money[0] + &quot;/&quot; + world.money[1];
        maincanvas.getElement(&quot;wood-amt&quot;).text = world.woods[0] + &quot;/&quot; + world.woods[1];
        maincanvas.getElement(&quot;stone-amt&quot;).text = world.stones[0] + &quot;/&quot; + world.stones[1];
        maincanvas.getElement(&quot;electricity-amt&quot;).text = world.electricity[0] + &quot;/&quot; + world.electricity[1];
    }
}

</code></pre>
<hr />
<details>
    <summary><strike>Code Explanation</strike></summary>
<p><em>(Nothing to explain here as code say itself)</em></p>
</details>
<hr />
<!-- tabs:end -->
<hr />
<p>Putting it all together and you should get something like this:</p>
<p><img src="../../CBS_2_2.gif" alt="Some Image" title=":size=400" /></p>
<p><strong>🎉 And We did it! We completed resources part! 🎉</strong></p>
<hr />
<p>If you have any problem then you can check the source code at <a href="https://github.com/BlackGoku36/CBST-A3D">CBST-A3D</a></p>
<hr />
<blockquote style="border-color: #DA0B50;">
    <p>
    W.I.P.
    </p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../GameDemo/CitySim/Basics.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../GameDemo/CitySim/UI.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../GameDemo/CitySim/Basics.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../GameDemo/CitySim/UI.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
